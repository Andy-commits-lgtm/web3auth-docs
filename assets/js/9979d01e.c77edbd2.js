"use strict";(self.webpackChunkweb3auth_docs=self.webpackChunkweb3auth_docs||[]).push([[92595],{65165:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>h,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var n=a(85893),s=a(11151),r=a(85162),i=a(74866);const o={title:"Account Abstraction with SafeAuth Kit",sidebar_label:"SafeAuth",image:"content-hub/guides/banners/safeauth.png",displayed_sidebar:"docs",keywords:["safe","safeauth kit","safeauth","web3auth","authentication","blockchain"],description:"Account Abstraction with SafeAuth Kit | Documentation - Web3Auth"},c=void 0,l={id:"account-abstraction/safeauth",title:"Account Abstraction with SafeAuth Kit",description:"Account Abstraction with SafeAuth Kit | Documentation - Web3Auth",source:"@site/docs/account-abstraction/safeauth.mdx",sourceDirName:"account-abstraction",slug:"/account-abstraction/safeauth",permalink:"/docs/account-abstraction/safeauth",draft:!1,unlisted:!1,editUrl:"https://github.com/web3auth/web3auth-docs/edit/master/docs/account-abstraction/safeauth.mdx",tags:[],version:"current",frontMatter:{title:"Account Abstraction with SafeAuth Kit",sidebar_label:"SafeAuth",image:"content-hub/guides/banners/safeauth.png",displayed_sidebar:"docs",keywords:["safe","safeauth kit","safeauth","web3auth","authentication","blockchain"],description:"Account Abstraction with SafeAuth Kit | Documentation - Web3Auth"},sidebar:"docs",previous:{title:"v1 to v2",permalink:"/docs/core-kit/migration-guides/sfa-flutter-v1-to-v2"},next:{title:"Dashboard Setup",permalink:"/docs/dashboard-setup/"}},h={},u=[{value:"Install SafeAuth Kit",id:"install-safeauth-kit",level:2},{value:"Create a SafeAuthPack instance",id:"create-a-safeauthpack-instance",level:2},{value:"Sign in to an Ethereum account",id:"sign-in-to-an-ethereum-account",level:2},{value:"Sign In",id:"sign-in",level:3},{value:"Create Safe",id:"create-safe",level:3},{value:"Provider",id:"provider",level:3},{value:"Sign Out",id:"sign-out",level:3},{value:"Signing and executing transactions",id:"signing-and-executing-transactions",level:2},{value:"Sign messages using the <code>SafeAuthPack</code>",id:"sign-messages-using-the-safeauthpack",level:2}];function d(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.a)(),...e.components},{Details:a}=t;return a||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.a,{href:"https://safe.global/",children:"Safe"})," is a platform that makes it possible for anyone to own a digital account. It establishes universal and transparent\nstandards for the storage of digital assets, data, and identity. With ",(0,n.jsx)(t.strong,{children:(0,n.jsx)(t.a,{href:"https://www.npmjs.com/package/@safe-global/auth-kit",children:"SafeAuth Kit"})}),", you can\neasily create smart wallets that work seamlessly with ",(0,n.jsx)(t.a,{href:"https://eips.ethereum.org/EIPS/eip-4337",children:"ERC-4337"}),", using the user's EOA as the smart wallet's\nsigner. This simplifies the process of incorporating ",(0,n.jsx)(t.a,{href:"https://ethereum.org/en/roadmap/account-abstraction/",children:"Account Abstraction"})," features into your\napplication."]}),"\n",(0,n.jsx)(t.admonition,{type:"tip",children:(0,n.jsxs)(t.p,{children:["Check out our ",(0,n.jsx)(t.a,{href:"https://w3a-safe-demo.vercel.app/",children:(0,n.jsx)(t.strong,{children:"example app"})})," and\n",(0,n.jsx)(t.a,{href:"https://github.com/Web3Auth/web3auth-pnp-examples/tree/main/web-modal-sdk/account-abstraction/web3auth-safe-example",children:(0,n.jsx)(t.strong,{children:"repository"})})," for an\nend-to-end ",(0,n.jsx)(t.strong,{children:"Web3Auth"})," and ",(0,n.jsx)(t.strong,{children:"SafeAuth Kit integration"}),"."]})}),"\n",(0,n.jsxs)(a,{children:[(0,n.jsx)("summary",{children:(0,n.jsx)("b",{children:"What is an EOA?"})}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:[(0,n.jsxs)(t.p,{children:["An"," "]}),(0,n.jsx)("a",{href:"https://ethereum.org/en/developers/docs/accounts/",target:"_blank",children:(0,n.jsx)("b",{children:"EOA, or externally-owned account"})})," ",(0,n.jsx)(t.p,{children:"is a type of Ethereum account that is controlled by a private key. EOAs can be created through Web3Auth, or by using external wallets such as\nMetaMask, Coinbase Wallet, Rainbow Wallet, etc."})]}),(0,n.jsxs)("p",{children:[(0,n.jsxs)(t.p,{children:["On the other hand, there are ",(0,n.jsx)("b",{children:"contract accounts"})," that are controlled by smart contract codes and do not have their own private key. Safe's\nsmart wallet is a contract account that has"," "]}),(0,n.jsx)("a",{href:"https://ethereum.org/en/roadmap/account-abstraction/",target:"_blank",children:(0,n.jsx)(t.p,{children:"enhanced capabilities, such as gas sponsorship and batched transactions."})})]}),(0,n.jsx)("p",{children:(0,n.jsxs)(t.p,{children:["Since contract accounts do not have their own private key, they require a ",(0,n.jsx)("b",{children:"signer"})," to initiate transaction flows and produce signatures.\nSigners are usually EOAs that authorize actions taken by the contract account via a signature."]})}),(0,n.jsx)("p",{children:(0,n.jsx)(t.p,{children:'In this integration, the user\'s EOA (from Web3Auth) serves as the signer for their smart wallet (from Safe). The smart wallet (Safe) holds all\nassets and submits all transactions to the network. However, the signer (Web3Auth) is responsible for producing signatures and "kicking off"\ntransaction flows.'})})]})]}),"\n",(0,n.jsx)(t.h2,{id:"install-safeauth-kit",children:"Install SafeAuth Kit"}),"\n",(0,n.jsxs)(t.p,{children:["To get started, install the ",(0,n.jsx)(t.a,{href:"https://www.npmjs.com/package/@safe-global/auth-kit",children:(0,n.jsx)(t.code,{children:"@safe-global/auth-kit"})})," SDK from Safe."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"npm i @safe-global/auth-kit\n"})}),"\n",(0,n.jsx)(t.h2,{id:"create-a-safeauthpack-instance",children:"Create a SafeAuthPack instance"}),"\n",(0,n.jsxs)(t.p,{children:["To integrate SafeAuth into your application, start by creating an instance of the ",(0,n.jsx)(t.code,{children:"SafeAuthPack"})," class from the\n",(0,n.jsx)(t.a,{href:"https://www.npmjs.com/package/@safe-global/auth-kit",children:(0,n.jsx)(t.code,{children:"@safe-global/auth-kit"})})," package. This instance will be the entry point for managing\nauthentication and transactions."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:'import { SafeAuthPack, SafeAuthConfig, SafeAuthInitOptions } from "@safe-global/auth-kit";\n\nconst safeAuthInitOptions: SafeAuthInitOptions = {\n  showWidgetButton: false, // Set to true to show the SafeAuth widget button\n  chainConfig: {\n    blockExplorerUrl: "https://sepolia.etherscan.io", // The block explorer URL\n    chainId: "0xaa36a7", // The chain ID\n    displayName: "Ethereum Sepolia", // The chain name\n    rpcTarget: "https://rpc.ankr.com/eth_sepolia", // The RPC target\n    ticker: "ETH", // The chain ticker\n    tickerName: "Ethereum", // The chain ticker name\n  },\n};\n\nconst safeAuthPack = new SafeAuthPack();\nawait safeAuthPack.init(safeAuthInitOptions);\n'})}),"\n",(0,n.jsxs)(t.p,{children:["You should always call the ",(0,n.jsx)(t.code,{children:"init()"})," method afterward before interacting with the pack. The init method initializes the provided Web3Auth SDK and Safe\nservices. It creates an embedded browser wallet within an iframe, establishing communication through the internally generated EIP-1193 provider."]}),"\n",(0,n.jsx)(t.h2,{id:"sign-in-to-an-ethereum-account",children:"Sign in to an Ethereum account"}),"\n",(0,n.jsx)(t.h3,{id:"sign-in",children:"Sign In"}),"\n",(0,n.jsxs)(t.p,{children:["To start the authentication process, simply call the ",(0,n.jsx)(t.code,{children:"signIn()"})," method. This method is usually triggered when a user clicks on a ",(0,n.jsx)(t.code,{children:"Sign In"})," button on\nyour web application. Once the user has successfully signed in, a new Ethereum Wallet will be created. This wallet will be utilized for all future\nlogins and can be ",(0,n.jsx)(t.strong,{children:"shared across different applications"}),"."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:"const safeAuthSignInResponse = await safeAuthPack.signIn();\n"})}),"\n",(0,n.jsx)(t.p,{children:"The returned safeAuthSignInResponse contains the user's Ethereum address and associated Safe addresses."}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsx)(t.p,{children:"This method retrieves Safe addresses owned by the EOA, but does not create a Safe."}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:"AuthKitSignInData {\n  eoa: string // The safe signer\n  safes?: string[] // The list of associated Safe addresses in the chain\n}\n"})}),"\n",(0,n.jsx)(t.h3,{id:"create-safe",children:"Create Safe"}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:["Creation of a Safe is done by using the SafeFactory from the ",(0,n.jsx)(t.a,{href:"https://www.npmjs.com/package/@safe-global/protocol-kit",children:"Protocol Kit"}),". The Protocol\nKit is a library that provides a set of tools to interact with the Safe smart contract."]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"To create a Safe, use the following code:"})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:'import { ethers, BrowserProvider, Eip1193Provider } from "ethers";\nimport { EthersAdapter, SafeFactory } from "@safe-global/protocol-kit";\n\nconst provider = new BrowserProvider(safeAuthPack?.getProvider() as Eip1193Provider);\nconst signer = await provider.getSigner();\nconst ethAdapter = new EthersAdapter({\n  ethers,\n  signerOrProvider: signer,\n} as any);\n\nconst safeFactory = await SafeFactory.create({ ethAdapter });\nconst safe = await safeFactory.deploySafe({\n  safeAccountConfig: { threshold: 1, owners: [safeAuthSignInResponse?.eoa as string] },\n});\nconsole.log("SAFE Created!", await safe.getAddress());\n'})}),"\n",(0,n.jsx)(t.h3,{id:"provider",children:"Provider"}),"\n",(0,n.jsxs)(t.p,{children:["After authentication, use ",(0,n.jsx)(t.code,{children:"getProvider()"})," to obtain the Ethereum provider instance, compatible with ",(0,n.jsx)(t.strong,{children:"EIP-1193"}),"."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:"safeAuthPack.getProvider();\n"})}),"\n",(0,n.jsx)(t.h3,{id:"sign-out",children:"Sign Out"}),"\n",(0,n.jsxs)(t.p,{children:["To sign out the user, use the ",(0,n.jsx)(t.code,{children:"signOut()"})," method."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:"await safeAuthPack.signOut();\n"})}),"\n",(0,n.jsx)(t.h2,{id:"signing-and-executing-transactions",children:"Signing and executing transactions"}),"\n",(0,n.jsx)(t.p,{children:"Combine SafeAuth Kit with the Protocol Kit to connect to a Safe and perform transactions."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:'import { ethers, BrowserProvider, Eip1193Provider } from "ethers";\nimport { EthersAdapter } from "@safe-global/protocol-kit";\n\nconst provider = new BrowserProvider(safeAuthPack?.getProvider() as Eip1193Provider);\nconst signer = await provider.getSigner();\n\n// Create the Safe EthersAdapter\nconst ethAdapter = new EthersAdapter({\n  ethers,\n  signerOrProvider: signer || provider,\n});\n\nconst safeAddress = safeAuthSignInResponse?.safes?.[0] || "0x";\n\n// Instantiate the protocolKit\nconst protocolKit = await Safe.create({\n  ethAdapter,\n  safeAddress,\n});\n\n// Create a Safe transaction with the provided parameters\nconst safeTransactionData: MetaTransactionData = {\n  to: ethers.getAddress(safeAuthSignInResponse?.eoa || "0x"),\n  data: "0x",\n  value: ethers.parseUnits("0.0001", "ether").toString(),\n};\n\nconst safeTransaction = await protocolKit.createTransaction({\n  safeTransactionData,\n});\n\n// Sign transaction\nconst tx = await protocolKit.signTransaction(safeTransaction);\n\n// Execute the transaction\nconst txResult = await protocolKit.executeTransaction(tx);\n'})}),"\n",(0,n.jsxs)(t.h2,{id:"sign-messages-using-the-safeauthpack",children:["Sign messages using the ",(0,n.jsx)(t.code,{children:"SafeAuthPack"})]}),"\n",(0,n.jsx)(t.p,{children:"Sign messages or transactions using your preferred web3 library."}),"\n",(0,n.jsxs)(i.Z,{defaultValue:"web3",values:[{label:"web3.js",value:"web3"},{label:"ethers.js",value:"ethers"}],children:[(0,n.jsx)(r.Z,{value:"web3",children:(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:'// Using web3\nconst web3 = new Web3(safeAuthPack.getProvider());\n\nconst message = "Safe meets Web3Auth";\nconst address = safeAuthSignInResponse?.eoa || "0x";\nawait web3.eth.personal.sign(message, address);\nawait web3.eth.signTransaction(tx);\nawait web3.eth.sendTransaction(tx);\n'})})}),(0,n.jsx)(r.Z,{value:"ethers",children:(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-typescript",children:"// Using ethers\nconst provider = new BrowserProvider(safeAuthPack?.getProvider() as Eip1193Provider);\nconst signer = await provider.getSigner();\n\nawait signer.signMessage(message);\n\nawait signer.signTransaction(tx);\nawait signer.sendTransaction(tx);\n"})})})]}),"\n",(0,n.jsx)(t.p,{children:"The integration makes use of Web3Auth Wallet Services to offer users a secure and hassle-free authentication experience."})]})}function p(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},85162:(e,t,a)=>{a.d(t,{Z:()=>i});a(67294);var n=a(36905);const s={tabItem:"tabItem_Ymn6"};var r=a(85893);function i(e){let{children:t,hidden:a,className:i}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,n.Z)(s.tabItem,i),hidden:a,children:t})}},74866:(e,t,a)=>{a.d(t,{Z:()=>A});var n=a(67294),s=a(36905),r=a(12466),i=a(16550),o=a(20469),c=a(91980),l=a(67392),h=a(50012);function u(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function d(e){const{values:t,children:a}=e;return(0,n.useMemo)((()=>{const e=t??function(e){return u(e).map((e=>{let{props:{value:t,label:a,attributes:n,default:s}}=e;return{value:t,label:a,attributes:n,default:s}}))}(a);return function(e){const t=(0,l.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,a])}function p(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:a}=e;const s=(0,i.k6)(),r=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:t,groupId:a});return[(0,c._X)(r),(0,n.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(s.location.search);t.set(r,e),s.replace({...s.location,search:t.toString()})}),[r,s])]}function g(e){const{defaultValue:t,queryString:a=!1,groupId:s}=e,r=d(e),[i,c]=(0,n.useState)((()=>function(e){let{defaultValue:t,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:r}))),[l,u]=f({queryString:a,groupId:s}),[g,b]=function(e){let{groupId:t}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(t),[s,r]=(0,h.Nk)(a);return[s,(0,n.useCallback)((e=>{a&&r.set(e)}),[a,r])]}({groupId:s}),m=(()=>{const e=l??g;return p({value:e,tabValues:r})?e:null})();(0,o.Z)((()=>{m&&c(m)}),[m]);return{selectedValue:i,selectValue:(0,n.useCallback)((e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),b(e)}),[u,b,r]),tabValues:r}}var b=a(72389);const m={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var x=a(85893);function w(e){let{className:t,block:a,selectedValue:n,selectValue:i,tabValues:o}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,r.o5)(),h=e=>{const t=e.currentTarget,a=c.indexOf(t),s=o[a].value;s!==n&&(l(t),i(s))},u=e=>{let t=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{const a=c.indexOf(e.currentTarget)+1;t=c[a]??c[0];break}case"ArrowLeft":{const a=c.indexOf(e.currentTarget)-1;t=c[a]??c[c.length-1];break}}t?.focus()};return(0,x.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":a},t),children:o.map((e=>{let{value:t,label:a,attributes:r}=e;return(0,x.jsx)("li",{role:"tab",tabIndex:n===t?0:-1,"aria-selected":n===t,ref:e=>c.push(e),onKeyDown:u,onClick:h,...r,className:(0,s.Z)("tabs__item",m.tabItem,r?.className,{"tabs__item--active":n===t}),children:a??t},t)}))})}function v(e){let{lazy:t,children:a,selectedValue:s}=e;const r=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===s));return e?(0,n.cloneElement)(e,{className:"margin-top--md"}):null}return(0,x.jsx)("div",{className:"margin-top--md",children:r.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==s})))})}function j(e){const t=g(e);return(0,x.jsxs)("div",{className:(0,s.Z)("tabs-container",m.tabList),children:[(0,x.jsx)(w,{...e,...t}),(0,x.jsx)(v,{...e,...t})]})}function A(e){const t=(0,b.Z)();return(0,x.jsx)(j,{...e,children:u(e.children)},String(t))}},11151:(e,t,a)=>{a.d(t,{Z:()=>o,a:()=>i});var n=a(67294);const s={},r=n.createContext(s);function i(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);