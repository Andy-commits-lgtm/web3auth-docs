"use strict";(self.webpackChunkweb3auth_docs=self.webpackChunkweb3auth_docs||[]).push([[80770],{97102:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>x,frontMatter:()=>d,getAuthenticateUserData:()=>p,getUserInfoData:()=>h,metadata:()=>c,toc:()=>l});var t=i(85893),s=i(11151),r=i(66827);const d={title:"Social Login Users",displayed_sidebar:"docs",description:"Social Login Users | Documentation - Web3Auth",image:"images/docs-meta-cards/documentation-card.png"},o=void 0,c={id:"pnp/features/server-side-verification/social-login-users",title:"Social Login Users",description:"Social Login Users | Documentation - Web3Auth",source:"@site/docs/pnp/features/server-side-verification/social-login-users.mdx",sourceDirName:"pnp/features/server-side-verification",slug:"/pnp/features/server-side-verification/social-login-users",permalink:"/docs/pnp/features/server-side-verification/social-login-users",draft:!1,unlisted:!1,editUrl:"https://github.com/web3auth/web3auth-docs/edit/master/docs/pnp/features/server-side-verification/social-login-users.mdx",tags:[],version:"current",frontMatter:{title:"Social Login Users",displayed_sidebar:"docs",description:"Social Login Users | Documentation - Web3Auth",image:"images/docs-meta-cards/documentation-card.png"},sidebar:"docs",previous:{title:"Server Side Verification",permalink:"/docs/pnp/features/server-side-verification/"},next:{title:"External Wallets",permalink:"/docs/pnp/features/server-side-verification/external-wallets"}},a={},l=[{value:"Get idToken",id:"get-idtoken",level:2},{value:"<code>getUserInfo</code>",id:"getuserinfo",level:3},{value:"Returns",id:"returns",level:4},{value:"<code>authenticateUser</code>",id:"authenticateuser",level:3},{value:"Returns",id:"returns-1",level:4},{value:"Sample <code>idToken</code> payload",id:"sample-idtoken-payload",level:3},{value:"Verifying JWT Token (idToken)",id:"verifying-jwt-token-idtoken",level:2},{value:"Getting <code>app_pub_key</code> and <code>idToken</code> in Frontend",id:"getting-app_pub_key-and-idtoken-in-frontend",level:3},{value:"Verifying <code>idToken</code> in Backend",id:"verifying-idtoken-in-backend",level:3},{value:"Changing the Public Key Curve",id:"changing-the-public-key-curve",level:2}],h=[{name:"",description:"",tiles:[{key:"web",title:"Web",icon:"logo-js.png",path:"/sdk/pnp/web/modal/usage#get-users-information"},{key:"android",title:"Android (Kotlin)",icon:"logo-android.png",path:"/sdk/pnp/android/usage#web3authgetuserinfo"},{key:"apple",title:"iOS (Swift)",icon:"logo-apple.png",path:"/sdk/pnp/ios/usage#getuserinfo"},{key:"react-native",title:"React Native",icon:"logo-react.png",path:"/sdk/pnp/react-native/usage#getting-the-user-information"},{key:"flutter",title:"Flutter",icon:"logo-flutter.png",path:"/sdk/pnp/flutter/usage#getuserinfo"}]}],p=[{name:"",description:"",tiles:[{key:"web",title:"Web",icon:"logo-js.png",path:"/sdk/pnp/web/modal/usage#get-idtoken"}]}];function u(e){const n={admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"get-idtoken",children:"Get idToken"}),"\n",(0,t.jsx)(n.h3,{id:"getuserinfo",children:(0,t.jsx)(n.code,{children:"getUserInfo"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"await web3auth.getUserInfo();\n"})}),"\n",(0,t.jsx)(n.h4,{id:"returns",children:"Returns"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  // ... other properties\n  "idToken": "<jwtToken issued by Web3Auth>"\n  // ... other properties\n}\n'})}),"\n",(0,t.jsx)(r.Z,{tileGroups:h}),"\n",(0,t.jsx)(n.h3,{id:"authenticateuser",children:(0,t.jsx)(n.code,{children:"authenticateUser"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"await web3auth.authenticateUser();\n"})}),"\n",(0,t.jsx)(n.h4,{id:"returns-1",children:"Returns"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "idToken": "<jwtToken issued by Web3Auth>"\n}\n'})}),"\n",(0,t.jsx)(r.Z,{tileGroups:p}),"\n",(0,t.jsxs)(n.h3,{id:"sample-idtoken-payload",children:["Sample ",(0,t.jsx)(n.code,{children:"idToken"})," payload"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "iat": 1655835494,\n  "aud": "BCtbnOamqh0cJFEUYA0NB5YkvBECZ3HLZsKfvSRBvew2EiiKW3UxpyQASSR0artjQkiUOCHeZ_ZeygXpYpxZjOs",\n  "iss": "https://api-auth.web3auth.io/",\n  "email": "xyz@xyz.com",\n  "name": "John Doe",\n  "profileImage": "https://lh3.googleusercontent.com/a/AATXAJx3lnGmHiM4K97uLo9Rb0AxOceH-dQCBSRqGbck=s96-c",\n  "verifier": "torus",\n  "verifierId": "xyz@xyz.com",\n  "aggregateVerifier": "tkey-google-lrc",\n  "exp": 1655921894,\n  "wallets": [\n    {\n      "public_key": "035143318b83eb5d31611f8c03582ab1200494f66f5e11a67c34f5581f48c1b70b",\n      "type": "web3auth_key",\n      "curve": "secp256k1"\n    }\n  ]\n}\n'})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"iat"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"number"})}),(0,t.jsx)(n.td,{children:'The "iat" (issued at) claim identifies the time at which the JWT was issued.'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"aud"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsxs)(n.td,{children:['The "aud" (audience) claim identifies the recipients that the JWT is intended for. (Here, it\'s the dapp ',(0,t.jsx)(n.code,{children:"client_id"}),")"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"iss"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsxs)(n.td,{children:['The "iss" (issuer) claim identifies who issued the JWT. (Here, it\'s Web3Auth ',(0,t.jsx)(n.code,{children:"https://api.openlogin.com/"}),")"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"email"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"The email address of the user (optional)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"name"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"The name of the user (optional)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"profileImage"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"The profile image of the user (optional)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"verifier"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Web3auth's verifier used while user login"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"verifierId"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Unique user id given by OAuth login provider"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"aggregateVerifier"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Name of the verifier if you are using a single id verifier (aggregateVerifier) (optional)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"exp"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"number"})}),(0,t.jsxs)(n.td,{children:['The "exp" (expiration time) claim identifies the expiration time on or after which the ',(0,t.jsx)(n.em,{children:"JWT MUST NOT be accepted for processing"}),"."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"wallets"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"array"})}),(0,t.jsxs)(n.td,{children:["list of wallets for which this token is issued: ",(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:[(0,t.jsx)(n.code,{children:"curve"}),' "secp256k1" (default) or "ed25519" ',(0,t.jsx)("br",{})," You can specify which curve you want use for the encoded public key in the login parameters",(0,t.jsx)("br",{})]}),(0,t.jsxs)("li",{children:[(0,t.jsx)(n.code,{children:"type"}),' "web3auth_key" incase of social logins']}),(0,t.jsxs)("li",{children:[(0,t.jsx)(n.code,{children:"public_key"})," compressed public key derived based on the specified curve "]})]})]})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"verifying-jwt-token-idtoken",children:"Verifying JWT Token (idToken)"}),"\n",(0,t.jsxs)(n.p,{children:["In order to verify the JWT Token(",(0,t.jsx)(n.code,{children:"idToken"}),") you need the compressed ",(0,t.jsx)(n.strong,{children:"app_pub_key"})," (derived from ",(0,t.jsx)(n.em,{children:(0,t.jsx)(n.strong,{children:"app_scoped_privkey"})}),") and the ",(0,t.jsx)(n.code,{children:"idToken"})," obtained\nfrom the ",(0,t.jsx)(n.code,{children:"userInfo()"})," or ",(0,t.jsx)(n.code,{children:"authenticateUser()"}),"."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"App scoped wallet will be obtained from the frontend once the user is logged in."}),"\n",(0,t.jsx)(n.li,{children:"Public Key derivation depends on the curve (refer to the code snippets above)."}),"\n"]})}),"\n",(0,t.jsxs)(n.h3,{id:"getting-app_pub_key-and-idtoken-in-frontend",children:["Getting ",(0,t.jsx)(n.code,{children:"app_pub_key"})," and ",(0,t.jsx)(n.code,{children:"idToken"})," in Frontend"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'// Incase of ed25519 curve, get the app_pub_key\nimport { getED25519Key } from "@toruslabs/openlogin-ed25519";\nconst app_scoped_privkey = await web3auth.provider?.request({\n  method: "solanaPrivateKey",\n});\nconst ed25519Key = getED25519Key(Buffer.from(app_scoped_privkey.padStart(64, "0"), "hex"));\nconst app_pub_key = ed25519Key.pk.toString("hex");\n\n// Incase of secp256k1 curve, get the app_pub_key\nimport { getPublicCompressed } from "@toruslabs/eccrypto";\nconst app_scoped_privkey = await web3auth.provider?.request({\n  method: "eth_private_key", // use "private_key" for other non-evm chains\n});\nconst app_pub_key = getPublicCompressed(Buffer.from(app_scoped_privkey.padStart(64, "0"), "hex")).toString("hex");\n\n/* Assuming user is logged in, get the userInfo containtaing idToken */\nconst user = await web3auth.getUserInfo();\n\n/*\nOR\nconst token = await web3auth.authenticateUser();\n */\n\n// Verify idToken at your backend server\nconst res = await fetch("/api/verify", {\n  method: "POST",\n  headers: {\n    "Content-Type": "application/json",\n    Authorization: "Bearer " + user.idToken, // or token.idToken\n  },\n  body: JSON.stringify({ appPubKey: app_pub_key }),\n});\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"verifying-idtoken-in-backend",children:["Verifying ",(0,t.jsx)(n.code,{children:"idToken"})," in Backend"]}),"\n",(0,t.jsxs)(n.admonition,{title:"JWKS endpoint",type:"info",children:[(0,t.jsx)(n.p,{children:"Please note, the JWKS endpoint for Social logins are different from External Wallets."}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["JWKS Endpoint: ",(0,t.jsx)(n.code,{children:"https://api-auth.web3auth.io/jwks"})]}),"\n"]})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"// JWT verification using JWKS\n\nimport * as jose from \"jose\"\n\n// passed from the frontend in the Authorization header\nconst idToken = req.headers.authorization?.split(' ')[1];\n\n// passed from the frontend in the request body\nconst app_pub_key = req.body.appPubKey;\n\n// Get the JWK set used to sign the JWT issued by Web3Auth\n// highlight-next-line\nconst jwks = jose.createRemoteJWKSet(new URL(\"https://api-auth.web3auth.io/jwks\"));\n\n// Verify the JWT using Web3Auth's JWKS\nconst jwtDecoded = await jose.jwtVerify(idToken, jwks, { algorithms: [\"ES256\"] });\n\n// Checking `app_pub_key` against the decoded JWT wallet's public_key\nif ((jwtDecoded.payload as any).wallets[0].public_key.toLowerCase() === app_pub_key.toLowerCase()) {\n  // Verified\n  res.status(200).json({name: 'Verification Successful'})\n} else {\n  res.status(400).json({name: 'Verification Failed'})\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"changing-the-public-key-curve",children:"Changing the Public Key Curve"}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["By default Web3Auth returns an ",(0,t.jsx)(n.code,{children:"idToken"})," which contains the ",(0,t.jsx)(n.code,{children:"public_key"})," in ",(0,t.jsx)(n.code,{children:"secp256k1"})," form."]})}),"\n",(0,t.jsxs)(n.p,{children:["If you want to encode the public_key in ",(0,t.jsx)(n.code,{children:"ed25519"})," format then you have to pass the curve parameter in OpenloginAdapter as:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:'const openloginAdapter = new OpenloginAdapter({\n  loginSettings: {\n    curve: "ed25519", // allowed values "secp256k1" (default) or "ed25519"\n  },\n});\n'})})]})}function x(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},66827:(e,n,i)=>{i.d(n,{Z:()=>o});var t=i(33692),s=i(44996);const r={tileGroup:"tileGroup_L0V_",tileGroupContent:"tileGroupContent_e3oe",tile:"tile_cD2P",tileIcon:"tileIcon_Ir17",tileText:"tileText_xjfR"};var d=i(85893);function o(e){const{tileGroups:n}=e;return(0,d.jsx)(d.Fragment,{children:n.map((e=>(0,d.jsxs)("div",{className:r.tileGroup,children:[(0,d.jsx)("h3",{children:e.name}),(0,d.jsx)("p",{children:e.description}),(0,d.jsx)("div",{className:r.tileGroupContent,children:e.tiles.map((e=>(0,d.jsxs)(t.Z,{className:r.tile,to:e.path,children:[e.icon?(0,d.jsx)("img",{className:r.tileIcon,src:(0,s.Z)(`/content-hub/${e.icon}`),alt:e.icon}):(0,d.jsx)("div",{}),(0,d.jsx)("div",{className:r.tileText,children:e.title})]},e.key)))})]},e.name)))})}},11151:(e,n,i)=>{i.d(n,{Z:()=>o,a:()=>d});var t=i(67294);const s={},r=t.createContext(s);function d(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);